<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="SV_Fragment :: head"/>
<head>
    <meta charset="UTF-8">
    <title>Trang Lớp Học</title>
    <!-- modals CSS -->
    <link rel="stylesheet" th:href="@{/css/modals.css}">
</head>
<head th:replace="SV_Fragment :: style-head"/>
<body>
<!-- Start Left menu area -->
<div th:replace="SV_Fragment :: frag_menu_left"/>
<!-- Content area -->
<div class="all-content-wrapper">
    <!--    Logo header mobile -->
    <div th:replace="SV_Fragment ::frag_icon_mobile"/>
    <!--    Header area -->
    <div th:replace="SV_Fragment :: frag_header"/>
    <!-- Single pro tab review Start-->
    <div class="single-pro-review-area mt-t-30 mg-b-15">
        <div class="container-fluid">
            <div class="row">
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                    <div class="basic-login-inner inline-basic-form">
                        <form action="#">
                            <div class="form-group-inner">
                                <div class="row">
                                    <div class="col-lg-3 col-md-3 col-sm-3 col-xs-12">
                                        <label class="login2 pull-right pull-right-pro">Chọn Học Kỳ</label>
                                    </div>
                                    <div class="col-lg-7 col-md-7 col-sm-7 col-xs-12">
                                        <div class="form-select-list">
                                            <form th:action="@{/hoc-phan/dang-ky-hoc-phan}" method="get">
                                                <select class="form-control custom-select-value" th:name="maHK"
                                                        th:onchange="this.form.submit()">
                                                    <option value="">Chọn đợt đăng ký</option>
                                                    <option th:each="hk: ${HKLHP}"
                                                            th:value="${hk.hocKy.maHK}"
                                                            th:text="'Học kỳ ' + ${hk.getHocKy().getThuTuHocKy()} + ' (' + ${hk.getHocKy().getNamBatDau()} + ' - ' + ${hk.getHocKy().getNamKetThuc()} + ')'"
                                                            th:selected="${maHK == hk.getHocKy().getMaHK()}">
                                                    </option>
                                                </select>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                    <div class="sparkline13-list">
                        <div class="sparkline13-hd">
                            <div class="main-sparkline13-hd">
                                <h1>Môn học/học phần đang chờ đăng ký</h1>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                    <table class="table table-bordered" width="100%">
                        <thead>
                        <tr class="active">
                            <th style="min-width: 20px">STT</th>
                            <th style="min-width: 150px; text-align: center">Mã học phần</th>
                            <th style="min-width: 200px; text-align: center">Tên môn học/học phần</th>
                            <th>Số Tín Chỉ</th>
                            <th>Bắt Buộc</th>
                            <th>học phần: học trước (a),
                                tiên quyết (b),
                                song hành (c)
                            </th>
                            <th>Đăng Ký</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="hp, status : ${danhsachHP}">
                            <td style="min-widtd: 20px" th:text="${status.index + 1}"></td>
                            <td style="min-widtd: 150px; text-align: center" th:text="${hp.getMaHocPhan()}"></td>
                            <td style="min-widtd: 200px; text-align: center"
                                th:text="${hp.getMonHoc().getTenMonHoc()}"></td>
                            <td th:text="${hp.getSoTCLT()}+${hp.getSoTCTH()}"></td>
                            <td th:if="${hp.hocPhanBatBuoc == true}">
                                <i class="fa fa-check-circle"></i>
                            </td>
                            <td th:if="${hp.hocPhanBatBuoc == false}">
                                <i class="fa fa-times-circle"></i>
                            </td>
                            <td>001496 (a)</td>
                            <td>
                                <button type="button" class="btn btn-custon-two btn-success"
                                        th:onclick="xemLopHocPhan([[${hp.maHocPhan}]],[[${maHK}]])">Đăng Ký
                                </button>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12">
                    <div class="row">
                        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                            <div class="sparkline13-list">
                                <div class="sparkline13-hd">
                                    <div class="main-sparkline13-hd">
                                        <h1>Lớp học phần chờ đăng ký</h1>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                            <table class="table table-bordered" width="100%">
                                <thead>
                                <tr class="active">
                                    <th>Mã lớp HP</th>
                                    <th>Học phần</th>
                                    <th>Lớp học phần</th>
                                    <th>Đã đăng ký</th>
                                </tr>
                                </thead>
                                <tbody id="tableLopHocPhan">
                                </tbody>
                            </table>
                            <script>
                                function xemLopHocPhan(id, hocKy) {
                                    $.ajax({
                                        url: "/hoc-phan/dang-ky-hoc-phan/lop-hoc-phan",
                                        type: 'POST',
                                        data: jQuery.param({maHocPhan: id, maHocKy: hocKy}),
                                        beforeSend: function () {
                                            loadingMark();
                                        },
                                        success: function (data) {
                                            removeLoadingMark();
                                            var table = document.getElementById('tableLopHocPhan');
                                            table.innerHTML = '';
                                            var row = '';
                                            for (var i = 0; i < data.length; i++) {
                                                row = `<tr onclick="xemCTLHP(${data[i].maLopHocPhan})"><td>${data[i].maLopHocPhan}</td><td>${data[i].tenLop}</td><td>${data[i].tenVietTat} (${data[i].trangThai})</td><td>${data[i].soLuongDangKyHienTai}/${data[i].soLuongDangKyToiDa}</td></tr>`;
                                                table.innerHTML += row;
                                            }
                                        },
                                    });
                                }

                                function removeLoadingMark() {
                                    $('.k-loading-mask').remove();
                                }

                                function loadingMark() {
                                    var html = '<div class="k-loading-mask" style="width: 100%;height: 100%;top: 0px;left: 0px;z-index: 999;display: block;background-color: #607d8b2b;position: fixed;bottom: 0px;"><i class="fa fa-spinner fa-pulse fa-3x fa-fw" style="position:absolute;left:45%;color:#4287f5;margin-top:20%;font-size:150px;"></i></div>';
                                    $(html).appendTo(document.body);
                                }
                            </script>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12">
                    <div class="row">
                        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                            <div class="sparkline13-list">
                                <div class="sparkline13-hd">
                                    <div class="main-sparkline13-hd" id="title-cthp">
                                        <h1>Chi tiết lớp học phần</h1>
                                    </div>
                                </div>
                                <input type="button" class="btn btn-custon-four btn-warning" data-toggle="modal" data-target="#WarningModalhdbgcl"
                                       value="Xem học phần trùng">
                                <button type="button" class="btn btn-custon-four btn-success"
                                        th:onclick="dangKyHocPhan([[${maHK}]])">Đăng Ký Học Phần</button>
                                <script>
                                    function dangKyHocPhan(hocKy) {
                                        var maCTLH = document.getElementById('title-cthp');
                                        // var id = maCTLH.str.match(/[0-9]$/)[0];
                                        $.ajax({
                                            url: "/hoc-phan/dang-ky-hoc-phan/dang-ky-lop-hoc-phan",
                                            type: 'POST',
                                            data: jQuery.param({maCTLHP : 2, maHocKy: hocKy}),
                                            beforeSend: function () {
                                                loadingMark();
                                            }, success: function (data) {
                                                removeLoadingMark();
                                                var table = document.getElementById('table-lhpdadk');
                                                table.innerHTML = '';
                                                var row = '';
                                                for (var i = 0; i < data.length; i++) {
                                                    row = `<tr><td>${i + 1}</td><td>${data[i].maLHP}</td><td>${data[i].tenLHP}</td><td>${data[i].lopHocDK}</td><td>${data[i].soTC}</td><td>${data[i].nhomTH}</td><td>${data[i].hocPhi}</td><td>${data[i].trangThaiDK}</td><td>${data[i].ngayDK}</td><td>${data[i].trangThaiLHP}</td></tr>`;
                                                    table.innerHTML += row;
                                                }

                                            }
                                        });
                                    }
                                </script>

                                <div id="WarningModalhdbgcl" class="modal modal-edu-general Customwidth-popup-WarningModal fade" role="dialog">
                                    <div class="modal-dialog" style="width: 80vw">
                                        <div class="modal-content">
                                            <div class="modal-header header-color-modal bg-color-3">
                                                <h4 class="modal-title">Kiểm Tra Học Phần Trùng</h4>
                                                <div class="modal-close-area modal-close-df">
                                                    <a class="close" data-dismiss="modal" href="#"><i class="fa fa-close"></i></a>
                                                </div>
                                            </div>
                                            <div class="modal-body">
                                                <h2>Warning!</h2>
                                                <table class="table table-bordered" width="100%">
                                                    <thead>
                                                    <tr class="active">
                                                        <th>Tiết học</th>
                                                        <th>CS-Phòng học</th>
                                                        <th>Giáo viên</th>
                                                        <th>Ngày học</th>
                                                    </tr>
                                                    </thead>
                                                    <tbody>
                                                    </tbody>
                                                </table>
                                            </div>
                                            <div class="modal-footer warning-md">
                                                <a data-dismiss="modal" href="#">Cancel</a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                            <table class="table table-bordered" width="100%">
                                <thead>
                                <tr class="active">
                                    <th>Tiết học</th>
                                    <th>CS-Phòng học</th>
                                    <th>Giáo viên</th>
                                    <th>Ngày học</th>
                                </tr>
                                </thead>
                                <tbody id="table-cthp">
                                </tbody>
                            </table>
                            <script>
                                function xemCTLHP(id) {
                                    $.ajax({
                                        url: "/hoc-phan/dang-ky-hoc-phan/chi-tiet-lop-hoc-phan",
                                        type: 'POST',
                                        data: jQuery.param({maLHP: id}),
                                        beforeSend: function () {
                                            loadingMark();
                                        },
                                        success: function (data) {
                                            removeLoadingMark();
                                            var table = document.getElementById('table-cthp');
                                            table.innerHTML = '';
                                            document.getElementById('title-cthp').innerHTML = `<h1>Chi tiết lớp học phần: ${id}</h1>`;
                                            var row = '';
                                            for (var i = 0; i < data.length; i++) {
                                                row = `<tr><td>${data[i].tietHoc}</td><td>${data[i].coSo} ${data[i].phongHoc}</td><td>${data[i].tenGiaoVien}</td><td>${data[i].ngayBatDau} - ${data[i].ngayKetThuc}</td></tr>`;
                                                table.innerHTML += row;
                                            }
                                        },
                                    });
                                }
                            </script>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                    <div class="sparkline13-list">
                        <div class="sparkline13-hd">
                            <div class="main-sparkline13-hd">
                                <h1>Lớp học phần đã đăng ký trong học kỳ này</h1>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                    <table class="table table-bordered" width="100%">
                        <thead>
                        <tr class="active">
                            <th>STT</th>
                            <th>Mã lớp học phần</th>
                            <th>Tên môn học/học phần</th>
                            <th>Lớp học dự kiến</th>
                            <th>TC</th>
                            <th>Nhóm TH</th>
                            <th>Học phí</th>
                            <th>Trạng thái ĐK</th>
                            <th>Ngày ĐK</th>
                            <th>Trạng thái Lớp học phần</th>
                            <th colspan="2">Hành Động</th>
                        </tr>
                        </thead>
                        <tbody id="table-lhpdadk">
<!--                        <tr>-->
<!--                            <td>1</td>-->
<!--                            <td>4220001459</td>-->
<!--                            <td>Anh văn 1</td>-->
<!--                            <td>DHKTPM14ATT</td>-->
<!--                            <td>3</td>-->
<!--                            <td>3</td>-->
<!--                            <td>2.370.000</td>-->
<!--                            <td>Đăng ký mới</td>-->
<!--                            <td>13/07/2021</td>-->
<!--                            <td>Đã khóa</td>-->
<!--                            <td>-->
<!--                                <input type="button" class="btn btn-custon-four btn-primary" value="Xem">-->
<!--                            </td>-->
<!--                            <td>-->
<!--                                <input type="button" class="btn btn-custon-four btn-danger" value="Xoá">-->
<!--                            </td>-->
<!--                        </tr>-->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <!--    Footer-->
    <div th:replace="SV_Fragment :: frag_footer"/>
</div>
<!-- Script-->
<div th:replace="SV_Fragment :: script"/>
</body>
</html>